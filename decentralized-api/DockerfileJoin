FROM alpine:edge

WORKDIR /root

ENV DAEMON_HOME=/root/.dapi
ENV DAEMON_NAME=decentralized-api
ENV DAEMON_ALLOW_DOWNLOAD_BINARIES=true
ENV DAEMON_RESTART_AFTER_UPGRADE=true


# Copy over binaries from the build-env
COPY ./build/dapi /usr/bin/decentralized-api
COPY ./scripts/init-docker.sh /root/init-docker.sh
ENV API_CONFIG_PATH=/root/api-config.yaml
COPY ./config-prod.yaml /root/api-config.yaml
COPY ./cosmovisor/v1.7.0/linux-amd64/cosmovisor /usr/bin/cosmovisor

RUN chmod +x /root/init-docker.sh
RUN apk update && \
    apk add --no-cache sed

EXPOSE 8080

CMD ["sh", "./init-docker.sh"]
